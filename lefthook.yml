# Configuration for lefthook git hooks
# See documentation: https://lefthook.dev/configuration/

# Run before pushing to remote
pre-push:
  parallel: true
  jobs:
    - name: run tests
      tags:
        - backend
        - testing
      run: bin/rake test

    - name: gems audit
      tags:
        - backend
        - security
      run: bundle check

# Run before committing changes
pre-commit:
  parallel: true
  jobs:
    - name: standard
      glob: "*.rb"
      run: bundle exec standardrb --fix {staged_files}
      
    # - name: erb lint
    #   glob: "*.erb"
    #   run: bundle exec erb_lint {staged_files}
      
    # - name: Rails best practices
    #   glob: "*.rb"
    #   run: bundle exec rails_best_practices {staged_files}
      
    - name: Brakeman
      tags:
        - security
        - backend
      run: bin/brakeman -q --no-pager
      
    - name: Check schema migrations
      run: bin/rails db:migrate:status

# Run after checkout
post-checkout:
  jobs:
    - name: package check
      run: bundle check || bundle install
